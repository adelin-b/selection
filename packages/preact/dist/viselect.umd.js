/*! @viselect/preact v3.2.6 MIT | https://github.com/Simonwep/selection/tree/master/packages/preact */
(function(b,u){typeof exports=="object"&&typeof module<"u"?u(exports,require("preact")):typeof define=="function"&&define.amd?define(["exports","preact"],u):(b=typeof globalThis<"u"?globalThis:b||self,u(b.SelectionArea={},b.Preact))})(this,function(b,u){"use strict";/*! @viselect/vanilla v3.2.6 MIT | https://github.com/Simonwep/selection/tree/master/packages/vanilla */var Q=Object.defineProperty,U=(s,t,e)=>t in s?Q(s,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):s[t]=e,d=(s,t,e)=>(U(s,typeof t!="symbol"?t+"":t,e),e);class Z{constructor(){d(this,"_listeners",new Map),d(this,"on",this.addEventListener),d(this,"off",this.removeEventListener),d(this,"emit",this.dispatchEvent)}addEventListener(t,e){const i=this._listeners.get(t)||new Set;return this._listeners.set(t,i),i.add(e),this}removeEventListener(t,e){var i;return(i=this._listeners.get(t))==null||i.delete(e),this}dispatchEvent(t,...e){let i=!0;for(const o of this._listeners.get(t)||[])i=o(...e)!==!1&&i;return i}unbindAllListeners(){this._listeners.clear()}}const D=(s,t="px")=>typeof s=="number"?s+t:s;function y({style:s},t,e){if(typeof t=="object")for(const[i,o]of Object.entries(t))o!==void 0&&(s[i]=D(o));else e!==void 0&&(s[t]=D(e))}function P(s){return(t,e,i,o={})=>{t instanceof HTMLCollection||t instanceof NodeList?t=Array.from(t):Array.isArray(t)||(t=[t]),Array.isArray(e)||(e=[e]);for(const n of t)for(const l of e)n[s](l,i,{capture:!1,...o});return[t,e,i,o]}}const A=P("addEventListener"),E=P("removeEventListener"),w=s=>{const{clientX:t,clientY:e,target:i}=s.touches&&s.touches[0]||s;return{x:t,y:e,target:i}};function j(s,t,e="touch"){switch(e){case"center":{const i=t.left+t.width/2,o=t.top+t.height/2;return i>=s.left&&i<=s.right&&o>=s.top&&o<=s.bottom}case"cover":return t.left>=s.left&&t.top>=s.top&&t.right<=s.right&&t.bottom<=s.bottom;case"touch":return s.right>=t.left&&s.left<=t.right&&s.bottom>=t.top&&s.top<=t.bottom}}function T(s,t=document){const e=Array.isArray(s)?s:[s];let i=[];for(let o=0,n=e.length;o<n;o++){const l=e[o];typeof l=="string"?i=i.concat(Array.from(t.querySelectorAll(l))):l instanceof Element&&i.push(l)}return i}const tt=()=>matchMedia("(hover: none), (pointer: coarse)").matches,et=()=>"safari"in window,it=s=>{let t,e=-1,i=!1;return{next(...o){t=o,i||(i=!0,e=requestAnimationFrame(()=>{s(...t),i=!1}))},cancel(){cancelAnimationFrame(e),i=!1}}},{abs:x,max:q,min:B,ceil:F}=Math;class C extends Z{constructor(t){var e,i,o,n,l;super(),d(this,"_options"),d(this,"_selection",{stored:[],selected:[],touched:[],changed:{added:[],removed:[]}}),d(this,"_area"),d(this,"_clippingElement"),d(this,"_targetElement"),d(this,"_targetRect"),d(this,"_selectables",[]),d(this,"_latestElement"),d(this,"_areaRect",new DOMRect),d(this,"_areaLocation",{y1:0,x2:0,y2:0,x1:0}),d(this,"_singleClick",!0),d(this,"_frame"),d(this,"_scrollAvailable",!0),d(this,"_scrollingActive",!1),d(this,"_scrollSpeed",{x:0,y:0}),d(this,"_scrollDelta",{x:0,y:0}),d(this,"disable",this._bindStartEvents.bind(this,!1)),d(this,"enable",this._bindStartEvents),this._options={selectionAreaClass:"selection-area",selectionContainerClass:void 0,selectables:[],document:window.document,startAreas:["html"],boundaries:["html"],container:"body",...t,behaviour:{overlap:"invert",intersect:"touch",...t.behaviour,startThreshold:(e=t.behaviour)!=null&&e.startThreshold?typeof t.behaviour.startThreshold=="number"?t.behaviour.startThreshold:{x:10,y:10,...t.behaviour.startThreshold}:{x:10,y:10},scrolling:{speedDivider:10,manualSpeed:750,...(i=t.behaviour)==null?void 0:i.scrolling,startScrollMargins:{x:0,y:0,...(n=(o=t.behaviour)==null?void 0:o.scrolling)==null?void 0:n.startScrollMargins}}},features:{range:!0,touch:!0,...t.features,singleTap:{allow:!0,intersect:"native",...(l=t.features)==null?void 0:l.singleTap}}};for(const f of Object.getOwnPropertyNames(Object.getPrototypeOf(this)))typeof this[f]=="function"&&(this[f]=this[f].bind(this));const{document:r,selectionAreaClass:a,selectionContainerClass:c}=this._options;this._area=r.createElement("div"),this._clippingElement=r.createElement("div"),this._clippingElement.appendChild(this._area),this._area.classList.add(a),c&&this._clippingElement.classList.add(c),y(this._area,{willChange:"top, left, bottom, right, width, height",top:0,left:0,position:"fixed"}),y(this._clippingElement,{overflow:"hidden",position:"fixed",transform:"translate3d(0, 0, 0)",pointerEvents:"none",zIndex:"1"}),this._frame=it(f=>{this._recalculateSelectionAreaRect(),this._updateElementSelection(),this._emitEvent("move",f),this._redrawSelectionArea()}),this.enable()}_bindStartEvents(t=!0){const{document:e,features:i}=this._options,o=t?A:E;o(e,"mousedown",this._onTapStart),i.touch&&o(e,"touchstart",this._onTapStart,{passive:!1})}_onTapStart(t,e=!1){const{x:i,y:o,target:n}=w(t),{_options:l}=this,{document:r}=this._options,a=n.getBoundingClientRect(),c=T(l.startAreas,l.document),f=T(l.boundaries,l.document);this._targetElement=f.find(g=>j(g.getBoundingClientRect(),a));const m=t.composedPath();if(!this._targetElement||!c.find(g=>m.includes(g))||!f.find(g=>m.includes(g))||!e&&this._emitEvent("beforestart",t)===!1)return;this._areaLocation={x1:i,y1:o,x2:0,y2:0};const h=r.scrollingElement||r.body;this._scrollDelta={x:h.scrollLeft,y:h.scrollTop},this._singleClick=!0,this.clearSelection(!1,!0),A(r,["touchmove","mousemove"],this._delayedTapMove,{passive:!1}),A(r,["mouseup","touchcancel","touchend"],this._onTapStop),A(r,"scroll",this._onScroll)}_onSingleTap(t){const{singleTap:{intersect:e},range:i}=this._options.features,o=w(t);let n;if(e==="native")n=o.target;else if(e==="touch"){this.resolveSelectables();const{x:r,y:a}=o;n=this._selectables.find(c=>{const{right:f,left:m,top:h,bottom:g}=c.getBoundingClientRect();return r<f&&r>m&&a<g&&a>h})}if(!n)return;for(this.resolveSelectables();!this._selectables.includes(n);){if(!n.parentElement)return;n=n.parentElement}const{stored:l}=this._selection;if(this._emitEvent("start",t),t.shiftKey&&l.length&&i){const r=this._latestElement??l[0],[a,c]=r.compareDocumentPosition(n)&4?[n,r]:[r,n],f=[...this._selectables.filter(m=>m.compareDocumentPosition(a)&4&&m.compareDocumentPosition(c)&2),a,c];this.select(f),this._latestElement=n}else l.includes(n)&&(l.length===1||t.ctrlKey||l.every(r=>this._selection.stored.includes(r)))?(this.deselect(n),this._latestElement=n):(this.select(n),this._latestElement=n);this._emitEvent("stop",t)}_delayedTapMove(t){const{container:e,document:i,behaviour:{startThreshold:o}}=this._options,{x1:n,y1:l}=this._areaLocation,{x:r,y:a}=w(t);if(typeof o=="number"&&x(r+a-(n+l))>=o||typeof o=="object"&&x(r-n)>=o.x||x(a-l)>=o.y){if(E(i,["mousemove","touchmove"],this._delayedTapMove,{passive:!1}),this._emitEvent("beforedrag",t)===!1){E(i,["mouseup","touchcancel","touchend"],this._onTapStop);return}A(i,["mousemove","touchmove"],this._onTapMove,{passive:!1}),y(this._area,"display","block"),T(e,i)[0].appendChild(this._clippingElement),this.resolveSelectables(),this._singleClick=!1,this._targetRect=this._targetElement.getBoundingClientRect(),this._scrollAvailable=this._targetElement.scrollHeight!==this._targetElement.clientHeight||this._targetElement.scrollWidth!==this._targetElement.clientWidth,this._scrollAvailable&&(A(i,"wheel",this._manualScroll,{passive:!1}),this._selectables=this._selectables.filter(c=>this._targetElement.contains(c))),this._setupSelectionArea(),this._emitEvent("start",t),this._onTapMove(t)}this._handleMoveEvent(t)}_setupSelectionArea(){const{_clippingElement:t,_targetElement:e,_area:i}=this,o=this._targetRect=e.getBoundingClientRect();this._scrollAvailable?(y(t,{top:o.top,left:o.left,width:o.width,height:o.height}),y(i,{marginTop:-o.top,marginLeft:-o.left})):(y(t,{top:0,left:0,width:"100%",height:"100%"}),y(i,{marginTop:0,marginLeft:0}))}_onTapMove(t){const{x:e,y:i}=w(t),{_scrollSpeed:o,_areaLocation:n,_options:l,_frame:r}=this,{speedDivider:a}=l.behaviour.scrolling,c=this._targetElement;if(n.x2=e,n.y2=i,this._scrollAvailable&&!this._scrollingActive&&(o.y||o.x)){this._scrollingActive=!0;const f=()=>{if(!o.x&&!o.y){this._scrollingActive=!1;return}const{scrollTop:m,scrollLeft:h}=c;o.y&&(c.scrollTop+=F(o.y/a),n.y1-=c.scrollTop-m),o.x&&(c.scrollLeft+=F(o.x/a),n.x1-=c.scrollLeft-h),r.next(t),requestAnimationFrame(f)};requestAnimationFrame(f)}else r.next(t);this._handleMoveEvent(t)}_handleMoveEvent(t){const{features:e}=this._options;(e.touch&&tt()||this._scrollAvailable&&et())&&t.preventDefault()}_onScroll(){const{_scrollDelta:t,_options:{document:e}}=this,{scrollTop:i,scrollLeft:o}=e.scrollingElement||e.body;this._areaLocation.x1+=t.x-o,this._areaLocation.y1+=t.y-i,t.x=o,t.y=i,this._setupSelectionArea(),this._frame.next(null)}_manualScroll(t){const{manualSpeed:e}=this._options.behaviour.scrolling,i=t.deltaY?t.deltaY>0?1:-1:0,o=t.deltaX?t.deltaX>0?1:-1:0;this._scrollSpeed.y+=i*e,this._scrollSpeed.x+=o*e,this._onTapMove(t),t.preventDefault()}_recalculateSelectionAreaRect(){const{_scrollSpeed:t,_areaLocation:e,_areaRect:i,_targetElement:o,_options:n}=this,{scrollTop:l,scrollHeight:r,clientHeight:a,scrollLeft:c,scrollWidth:f,clientWidth:m}=o,h=this._targetRect,{x1:g,y1:H}=e;let{x2:p,y2:_}=e;const{behaviour:{scrolling:{startScrollMargins:S}}}=n;p<h.left+S.x?(t.x=c?-x(h.left-p+S.x):0,p=p<h.left?h.left:p):p>h.right-S.x?(t.x=f-c-m?x(h.left+h.width-p-S.x):0,p=p>h.right?h.right:p):t.x=0,_<h.top+S.y?(t.y=l?-x(h.top-_+S.y):0,_=_<h.top?h.top:_):_>h.bottom-S.y?(t.y=r-l-a?x(h.top+h.height-_-S.y):0,_=_>h.bottom?h.bottom:_):t.y=0;const G=B(g,p),J=B(H,_),_t=q(g,p),ut=q(H,_);i.x=G,i.y=J,i.width=_t-G,i.height=ut-J}_redrawSelectionArea(){const{x:t,y:e,width:i,height:o}=this._areaRect,{style:n}=this._area;n.left=`${t}px`,n.top=`${e}px`,n.width=`${i}px`,n.height=`${o}px`}_onTapStop(t,e){var i;const{document:o,features:n}=this._options,{_singleClick:l}=this;E(o,["mousemove","touchmove"],this._delayedTapMove),E(o,["touchmove","mousemove"],this._onTapMove),E(o,["mouseup","touchcancel","touchend"],this._onTapStop),E(o,"scroll",this._onScroll),this._keepSelection(),t&&l&&n.singleTap.allow?this._onSingleTap(t):!l&&!e&&(this._updateElementSelection(),this._emitEvent("stop",t)),this._scrollSpeed.x=0,this._scrollSpeed.y=0,this._scrollAvailable&&E(o,"wheel",this._manualScroll,{passive:!0}),this._clippingElement.remove(),(i=this._frame)==null||i.cancel(),y(this._area,"display","none")}_updateElementSelection(){const{_selectables:t,_options:e,_selection:i,_areaRect:o}=this,{stored:n,selected:l,touched:r}=i,{intersect:a,overlap:c}=e.behaviour,f=c==="invert",m=[],h=[],g=[];for(let p=0;p<t.length;p++){const _=t[p];if(j(o,_.getBoundingClientRect(),a)){if(l.includes(_))n.includes(_)&&!r.includes(_)&&r.push(_);else if(f&&n.includes(_)){g.push(_);continue}else h.push(_);m.push(_)}}f&&h.push(...n.filter(p=>!l.includes(p)));const H=c==="keep";for(let p=0;p<l.length;p++){const _=l[p];!m.includes(_)&&!(H&&n.includes(_))&&g.push(_)}i.selected=m,i.changed={added:h,removed:g},this._latestElement=m[m.length-1]}_emitEvent(t,e){return this.emit(t,{event:e,store:this._selection,selection:this})}_keepSelection(){const{_options:t,_selection:e}=this,{selected:i,changed:o,touched:n,stored:l}=e,r=i.filter(a=>!l.includes(a));switch(t.behaviour.overlap){case"drop":{e.stored=[...r,...l.filter(a=>!n.includes(a))];break}case"invert":{e.stored=[...r,...l.filter(a=>!o.removed.includes(a))];break}case"keep":{e.stored=[...l,...i.filter(a=>!l.includes(a))];break}}}trigger(t,e=!0){this._onTapStart(t,e)}resolveSelectables(){this._selectables=T(this._options.selectables,this._options.document)}clearSelection(t=!0,e=!1){const{selected:i,stored:o,changed:n}=this._selection;n.added=[],n.removed.push(...i,...t?o:[]),e||(this._emitEvent("move",null),this._emitEvent("stop",null)),this._selection={stored:t?[]:o,selected:[],touched:[],changed:{added:[],removed:[]}}}getSelection(){return this._selection.stored}getSelectionArea(){return this._area}cancel(t=!1){this._onTapStop(null,!t)}destroy(){this.cancel(),this.disable(),this._clippingElement.remove(),super.unbindAllListeners()}select(t,e=!1){const{changed:i,selected:o,stored:n}=this._selection,l=T(t,this._options.document).filter(r=>!o.includes(r)&&!n.includes(r));return n.push(...l),o.push(...l),i.added.push(...l),i.removed=[],this._latestElement=void 0,e||(this._emitEvent("move",null),this._emitEvent("stop",null)),l}deselect(t,e=!1){const{selected:i,stored:o,changed:n}=this._selection,l=T(t,this._options.document).filter(r=>i.includes(r)||o.includes(r));l.length&&(this._selection.stored=o.filter(r=>!l.includes(r)),this._selection.selected=i.filter(r=>!l.includes(r)),this._selection.changed.added=[],this._selection.changed.removed.push(...l.filter(r=>!n.removed.includes(r))),this._latestElement=void 0,e||(this._emitEvent("move",null),this._emitEvent("stop",null)))}}d(C,"version","3.2.6");var O,v,R,$,N=0,V=[],L=[],W=u.options.__b,X=u.options.__r,Y=u.options.diffed,z=u.options.__c,K=u.options.unmount;function st(s,t){u.options.__h&&u.options.__h(v,s,N||t),N=0;var e=v.__H||(v.__H={__:[],__h:[]});return s>=e.__.length&&e.__.push({__V:L}),e.__[s]}function ot(s,t){var e=st(O++,3);!u.options.__s&&rt(e.__H,t)&&(e.__=s,e.i=t,v.__H.__h.push(e))}function nt(){for(var s;s=V.shift();)if(s.__P&&s.__H)try{s.__H.__h.forEach(M),s.__H.__h.forEach(k),s.__H.__h=[]}catch(t){s.__H.__h=[],u.options.__e(t,s.__v)}}u.options.__b=function(s){v=null,W&&W(s)},u.options.__r=function(s){X&&X(s),O=0;var t=(v=s.__c).__H;t&&(R===v?(t.__h=[],v.__h=[],t.__.forEach(function(e){e.__N&&(e.__=e.__N),e.__V=L,e.__N=e.i=void 0})):(t.__h.forEach(M),t.__h.forEach(k),t.__h=[])),R=v},u.options.diffed=function(s){Y&&Y(s);var t=s.__c;t&&t.__H&&(t.__H.__h.length&&(V.push(t)!==1&&$===u.options.requestAnimationFrame||(($=u.options.requestAnimationFrame)||lt)(nt)),t.__H.__.forEach(function(e){e.i&&(e.__H=e.i),e.__V!==L&&(e.__=e.__V),e.i=void 0,e.__V=L})),R=v=null},u.options.__c=function(s,t){t.some(function(e){try{e.__h.forEach(M),e.__h=e.__h.filter(function(i){return!i.__||k(i)})}catch(i){t.some(function(o){o.__h&&(o.__h=[])}),t=[],u.options.__e(i,e.__v)}}),z&&z(s,t)},u.options.unmount=function(s){K&&K(s);var t,e=s.__c;e&&e.__H&&(e.__H.__.forEach(function(i){try{M(i)}catch(o){t=o}}),e.__H=void 0,t&&u.options.__e(t,e.__v))};var I=typeof requestAnimationFrame=="function";function lt(s){var t,e=function(){clearTimeout(i),I&&cancelAnimationFrame(t),setTimeout(s)},i=setTimeout(e,100);I&&(t=requestAnimationFrame(e))}function M(s){var t=v,e=s.__c;typeof e=="function"&&(s.__c=void 0,e()),v=t}function k(s){var t=v;s.__c=s.__(),v=t}function rt(s,t){return!s||s.length!==t.length||t.some(function(e,i){return e!==s[i]})}var at=0;function ct(s,t,e,i,o,n){var l,r,a={};for(r in t)r=="ref"?l=t[r]:a[r]=t[r];var c={type:s,props:a,key:e,ref:l,__k:null,__:null,__b:0,__e:null,__d:void 0,__c:null,__h:null,constructor:void 0,__v:--at,__source:o,__self:n};if(typeof s=="function"&&(l=s.defaultProps))for(r in l)a[r]===void 0&&(a[r]=l[r]);return u.options.vnode&&u.options.vnode(c),c}const ht=s=>{const t=u.createRef();return ot(()=>{const{onBeforeStart:e,onBeforeDrag:i,onStart:o,onMove:n,onStop:l,...r}=s,a=t.current,c=new C({boundaries:a,...r});return e&&c.on("beforestart",e),i&&c.on("beforedrag",i),o&&c.on("start",o),n&&c.on("move",n),l&&c.on("stop",l),()=>c.destroy()},[]),ct("div",{ref:t,className:s.className,id:s.id,children:s.children})};b.VanillaSelectionArea=C,b.default=ht,Object.defineProperties(b,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})});
//# sourceMappingURL=viselect.umd.js.map
